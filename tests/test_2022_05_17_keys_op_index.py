"""
Tests for node operator registry key index counter for voting 17/05/2022
"""
import pytest


@pytest.fixture(scope="module")
def voting(accounts):
    return accounts[0]


def test_keys_op_index_increases(lido, node_operators_registry, voting):
    # keys_op_index is increased after assignNextSigningKeys()
    node_operators_registry.addNodeOperator(
        "foo", "0x0000000000000000000000000000000000000001", {"from": voting}
    )

    keys_op_index = node_operators_registry.getKeysOpIndex()
    node_operators_registry.addSigningKeys(
        0,
        2,
        "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020202",
        "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
        "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002",
        {"from": voting},
    )

    operator = lido.getOperators()
    operator.assignNextSigningKeys(1)

    assert keys_op_index < node_operators_registry.getKeysOpIndex()
